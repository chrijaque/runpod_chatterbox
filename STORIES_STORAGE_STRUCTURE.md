# 📚 Stories Storage Structure: Language-Based Story Management

## **Overview**

This document describes the new organized storage structure for TTS-generated stories that supports **language-based organization** and **user/app story separation**.

## **📁 Firebase Storage Structure**

```
gs://godnathistorie-a25fa.firebasestorage.app/audio/stories/
├── en/                          # English stories
│   ├── user/                    # User-generated stories
│   │   ├── gen_20250725_163000_TTS_voice_john_doe_20250725_163000.wav
│   │   └── gen_20250725_170000_TTS_voice_jane_smith_20250725_170000.wav
│   └── app/                     # App-generated/pre-written stories
│       ├── gen_20250725_165000_TTS_voice_system_20250725_165000.wav
│       └── gen_20250725_172000_TTS_voice_system_20250725_172000.wav
├── da/                          # Danish stories
│   ├── user/                    # User-generated stories
│   │   └── gen_20250725_164000_TTS_voice_peter_20250725_164000.wav
│   └── app/                     # App-generated stories
│       └── gen_20250725_171000_TTS_voice_system_20250725_171000.wav
├── fr/                          # French stories
│   ├── user/                    # User-generated stories
│   └── app/                     # App-generated stories
└── [other_languages]/
    ├── user/                    # User-generated stories
    └── app/                     # App-generated stories
```

## **🔄 TTS Generation Request Format**

### **Main App Request**

```json
{
  "voice_id": "voice_john_doe",
  "text": "Once upon a time, there was a magical forest...",
  "responseFormat": "base64",
  "language": "en",
  "is_kids_voice": false,
  "story_type": "user"  // "user" or "app"
}
```

### **API Response**

```json
{
  "status": "success",
  "generation_id": "gen_20250725_163000",
  "voice_id": "voice_john_doe",
  "text": "Once upon a time, there was a magical forest...",
  "audio_base64": "UklGRiQAAABXQVZFZm10...",
  "metadata": {
    "firebase_urls": {
      "story_url": "https://storage.googleapis.com/bucket/audio/stories/en/user/gen_20250725_163000_TTS_voice_john_doe_20250725_163000.wav"
    },
    "shared_access": true,
    "uploaded_at": "2025-07-25T16:30:00Z",
    "generation_id": "gen_20250725_163000",
    "language": "en",
    "is_kids_voice": false,
    "story_type": "user"
  }
}
```

## **🔗 API Endpoints**

### **Story Generation**

```bash
# Generate TTS story with organized storage
POST /api/tts/generate
Content-Type: application/x-www-form-urlencoded

voice_id=voice_john_doe&
text=Once upon a time...&
language=en&
is_kids_voice=false&
story_type=user
```

### **Story Management**

```bash
# List available story languages
GET /api/tts/stories/languages

# List stories by language and type
GET /api/tts/stories/en?story_type=user
GET /api/tts/stories/en?story_type=app
GET /api/tts/stories/da?story_type=user

# Alternative endpoint format
GET /api/tts/stories/en/user
GET /api/tts/stories/en/app
GET /api/tts/stories/da/user

# Get story audio from Firebase
GET /api/tts/stories/en/user/gen_20250725_163000/audio
GET /api/tts/stories/da/app/gen_20250725_171000/audio
```

## **🌍 Supported Story Languages**

The API supports the following languages for stories:

- **en** - English
- **es** - Spanish  
- **fr** - French
- **de** - German
- **it** - Italian
- **pt** - Portuguese
- **ru** - Russian
- **ja** - Japanese
- **ko** - Korean
- **zh** - Chinese
- **da** - Danish
- **sv** - Swedish
- **no** - Norwegian
- **nl** - Dutch
- **pl** - Polish

**Note**: Any language code can be used (dynamic support like voices)

## **📚 Story Types**

### **User Stories (`story_type: "user"`)**
- Stories generated by users
- Custom content created by users
- Personal stories and narratives
- User-generated content

### **App Stories (`story_type: "app"`)**
- Pre-written stories by the app
- System-generated content
- Template stories
- App-provided narratives

## **📊 File Naming Convention**

### **Story Files**

```
{generation_id}_{tts_filename}
```

Examples:
- `gen_20250725_163000_TTS_voice_john_doe_20250725_163000.wav`
- `gen_20250725_170000_TTS_voice_jane_smith_20250725_170000.wav`

## **🚀 Usage Examples**

### **Generate User Story**

```javascript
// Generate a user story in English
const formData = new FormData();
formData.append('voice_id', 'voice_john_doe');
formData.append('text', 'Once upon a time, there was a magical forest...');
formData.append('language', 'en');
formData.append('is_kids_voice', 'false');
formData.append('story_type', 'user');

const response = await fetch('/api/tts/generate', {
  method: 'POST',
  body: formData
});

const result = await response.json();
console.log('Story generated:', result.generation_id);
console.log('Story URL:', result.metadata.firebase_urls.story_url);
```

### **Generate App Story**

```javascript
// Generate an app story in Danish
const formData = new FormData();
formData.append('voice_id', 'voice_system');
formData.append('text', 'Der var engang en lille dreng...');
formData.append('language', 'da');
formData.append('is_kids_voice', 'false');
formData.append('story_type', 'app');

const response = await fetch('/api/tts/generate', {
  method: 'POST',
  body: formData
});
```

### **List Stories by Language**

```javascript
// List English user stories
const userStories = await fetch('/api/tts/stories/en?story_type=user');
const userData = await userStories.json();

// List English app stories
const appStories = await fetch('/api/tts/stories/en?story_type=app');
const appData = await appStories.json();

// List Danish user stories
const danishStories = await fetch('/api/tts/stories/da?story_type=user');
const danishData = await danishStories.json();

console.log('English user stories:', userData.total_stories);
console.log('English app stories:', appData.total_stories);
console.log('Danish user stories:', danishData.total_stories);
```

### **Get Story Audio**

```javascript
// Get story audio from Firebase
const storyAudio = await fetch('/api/tts/stories/en/user/gen_20250725_163000/audio');
const audioData = await storyAudio.json();

console.log('Story URL:', audioData.story_url);

// Play the story
const audio = new Audio(audioData.story_url);
audio.play();
```

### **List Available Languages**

```javascript
// Get all available story languages
const languages = await fetch('/api/tts/stories/languages');
const langData = await languages.json();

console.log('Available languages:', langData.languages);
```

## **🔧 Implementation Details**

### **Firebase Service Methods**

```python
# Upload story with language and type context
firebase_service.upload_runpod_tts_generation(
    generation_id, filename, language, is_kids_voice, story_type
)

# List stories with context
firebase_service.list_stories_by_language(language, story_type)
firebase_service.get_story_audio_url(generation_id, language, story_type)
```

### **Storage Path Generation**

```python
# Story path
f"audio/stories/{language}/{story_type}/{generation_id}_{filename}"
```

## **📈 Benefits**

### **✅ Organization Benefits**

1. **Language Separation**: Easy to manage stories by language
2. **Story Type Isolation**: Separate user and app stories
3. **Scalable Structure**: Easy to add new languages
4. **Clear Organization**: User vs app content clearly separated
5. **Easy Discovery**: Simple to find stories by language and type

### **🔄 Workflow Benefits**

1. **Automatic Organization**: Files automatically organized by language and type
2. **Easy Discovery**: Simple to find stories by language and type
3. **Shared Access**: Both apps can access the same organized structure
4. **Metadata Preservation**: All story metadata preserved and accessible

## **🎯 Use Cases**

### **User Stories**
- Personal narratives created by users
- Custom content generation
- User-created stories for children
- Personalized storytelling

### **App Stories**
- Pre-written fairy tales
- Educational content
- Template stories
- System-generated narratives
- Default story library

## **🎯 Next Steps**

1. **Test the new structure** with your main app
2. **Configure story types** as needed
3. **Add more languages** as required
4. **Implement story search** by language and type
5. **Add story analytics** per language and type

This organized stories structure provides a **scalable, maintainable, and user-friendly** way to manage TTS-generated stories across multiple languages and types, perfect for a production storytelling application. 